add_shad_shared_library(malloc_lib main.cpp)
target_compile_options(malloc_lib PRIVATE -fPIC)
set_target_properties(malloc_lib PROPERTIES OUTPUT_NAME "malloc")

add_shad_tests(test_malloc test.cpp)
add_dependencies(test_malloc malloc_lib)

add_shad_tests(test_malloc1 tests/test_simple.cpp)
add_shad_tests(test_malloc2 tests/test_malloc.cpp)
add_shad_tests(test_malloc3 tests/test_realloc.cpp)
add_shad_tests(test_malloc4 tests/test_calloc.cpp)
add_shad_tests(test_malloc5 tests/test_errors.cpp)
add_shad_tests(test_malloc6 tests/test_brk.cpp)
add_shad_tests(test_malloc7 tests/test_mmap.cpp)
add_shad_tests(test_malloc8 tests/test_extra.cpp)
add_shad_tests(test_malloc9 tests/test_chunksizes.cpp)
add_shad_tests(test_malloc10 tests/test_std.cpp)

add_dependencies(test_malloc test_malloc1)
add_dependencies(test_malloc test_malloc2)
add_dependencies(test_malloc test_malloc3)
add_dependencies(test_malloc test_malloc4)
add_dependencies(test_malloc test_malloc5)
add_dependencies(test_malloc test_malloc6)
add_dependencies(test_malloc test_malloc7)
add_dependencies(test_malloc test_malloc8)
add_dependencies(test_malloc test_malloc9)
add_dependencies(test_malloc test_malloc10)

target_compile_definitions(test_malloc PRIVATE LIB_PATH=\"$<TARGET_FILE:malloc_lib>\")

target_compile_definitions(test_malloc PRIVATE TEST1_PATH=\"$<TARGET_FILE:test_malloc1>\")
target_compile_definitions(test_malloc PRIVATE TEST2_PATH=\"$<TARGET_FILE:test_malloc2>\")
target_compile_definitions(test_malloc PRIVATE TEST3_PATH=\"$<TARGET_FILE:test_malloc3>\")
target_compile_definitions(test_malloc PRIVATE TEST4_PATH=\"$<TARGET_FILE:test_malloc4>\")
target_compile_definitions(test_malloc PRIVATE TEST5_PATH=\"$<TARGET_FILE:test_malloc5>\")
target_compile_definitions(test_malloc PRIVATE TEST6_PATH=\"$<TARGET_FILE:test_malloc6>\")
target_compile_definitions(test_malloc PRIVATE TEST7_PATH=\"$<TARGET_FILE:test_malloc7>\")
target_compile_definitions(test_malloc PRIVATE TEST8_PATH=\"$<TARGET_FILE:test_malloc8>\")
target_compile_definitions(test_malloc PRIVATE TEST9_PATH=\"$<TARGET_FILE:test_malloc9>\")
target_compile_definitions(test_malloc PRIVATE TEST10_PATH=\"$<TARGET_FILE:test_malloc10>\")
